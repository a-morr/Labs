\lab{Data Visualization}{Data Visualization} 
\objective{Use data visualizations to explore data and communicate effectively to others.}
\label{lab:DataVis}

\noindent\emph{The purpose of visualization is insight, not pictures.} \small{---Card, Mackinlay, \& Shneiderman (after Hamming)}

\medskip

\noindent\emph{The ability to take data---to be able to understand it, to process it,
to extract value from it, to visualize it, to communicate it---that's
going to be a hugely important skill in the next decades,... because
now we really do have essentially free and ubiquitous data. So the
complimentary scarce factor is the ability to understand that data and
extract value from it.} \small{---Hal Varian (Google's Chief Economist)}
% in The McKinsey Quarterly, Jan 2009



\section*{What is Data Visualization?} 
Data visualizations (or graphs) are used to understand and explore data as well as communicate results to others.  Often data is more easily interpreted or understood in graphical format than as a list of numbers or data points.  




\section*{Types of Visualizations}

Here are some of the most useful types of data visualizations.  We explain each of these in more detail below.

\begin{enumerate}


\item A \emph{bar chart} is generally the preferred method for displaying a small (discrete) collection of one-dimensional data points. Each discrete data point is represented as a bar whose length is determined by the value of the data (see Figure \ref{fig:barchart}).

\item A \emph{histogram} is a special type of  bar graph where the length of each bar corresponds to the number of data points in a certain range (sometimes called a \emph{bin}).  Histograms are useful for revealing statistical distributions (see Figure \ref{fig:healthcare}).

\item A \emph{line plot} plots $(x,y)$-pairs as points and connects them with a curve. 
You should use a line plot for graphing continuous functions or when there is a natural order to your two-dimensional data---for example when the data is a time series (a sequence of values over time). 

\item A \emph{scatter plot} plots $(x,y)$ tuples as discrete points.  This should be used instead of a line plot when the data is two-dimensional but has no natural order. 
 
A scatter plot can reveal correlation (or lack thereof) between $x$ and $y$. 


\item Three-dimensional data can be displayed on a two-dimensional page with a \emph{contour plot}.  This draws lines in the plane where the third value is constant---like a topographical map.  Filling in the contours with successive colors gives a  \emph{heat map} (see Figure \ref{fig:heatmap}).

Three-dimensional data can also be plotted as a surface in 3-space, but it is often difficult to find a view where none of the important features of the data are obscured.
A contour plot or a heat map can help avoid this problem and is often easier for the viewer to decode.


%
%
%\item A \emph{sparkline} is a word-sized graphic that is often embedded inline with the text. 
%Created by Edward Tufte, an innovator and recognized leader in the field of data visualizations, sparklines can be used to quickly communicate large-scale trends in a data set. They are also ideal for binary data sets. 
%Two sources for creating sparkplots in Python are \cite{sparkplots} and \cite{sparklineshtml}.
%%TODO: Add an example of a sparkline
%
%
%\item \emph{Small multiples} are several minature graphics of the same type in a single visualization. 
%Like sparklines, they were pioneered by Edward Tufte. Any of the plots discussed so far may be assembled into a small multiple. 
%Small multiples are useful for viewing trends over time, when the data associated to each time is more complex than a single number. 
%More generally, they can be used to compare many sets of similar data (\cite{tufte1990} p. 67). 
%Figure \ref{fig:log_plots} could be called a small multiple, though frequently they contain more subplots. 
%Recall that this kind of plot can be created in matplotlib with the command \li{plt.subplot()}.
\end{enumerate}

\subsection*{Bar Charts}

Bar charts are best for relatively small sets of discrete, one-dimensional data.  They are usually best presented with the bars running horizontally because when the bars are vertical the labels tend to run together.  The other possible solution to that problem---making the text vertical---is harder to read (see Figure \ref{fig:barchart}).  



\begin{figure}[h]
\centering
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{bar_chart_horizontal_sorted.png}
\end{subfigure}
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{bar_chart_unsorted.png}
\end{subfigure}
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{bar_chart_vertical_bars_horizontal_labels.png}
\end{subfigure}
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{bar_chart_vertical_bars_vertical_labels.png}
\end{subfigure}

\caption{Bar Charts.  Note how the good example in the upper left is easier to use for comparison than the upper right, and easier to read than the bottom two charts.  Also, the labels in the bottom left are overlapping and the labels in the bottom right are vertical, making it hard to read.}
\label{fig:barchart}
\end{figure}

You can create a bar chart in matplotlib with the commands \li{plt.bar()} and \li{plt.barh()}.
\begin{lstlisting}
# This code created the top right bar chart.
labels = 'Spam', 'Eggs', 'Ham', 'Sausage', 'Bacon', 'Baked beans','Lobster thermidor'
val = [10, 11, 18, 19, 20, 21, 22]    # the bar lengths
pos = np.arange(7)+.5    # the bar centers on the y axis
plt.barh(pos,val, align='center')
plt.yticks(pos, labels[::-1])
plt.show()
\end{lstlisting}

The data in a bar chart should generally be sorted in some natural way, based on the intended use.  If the chart will be used to compare the value of different data points, we usually sort by size; if the chart will be used for looking up specific values, the data could be sorted alphabetically or in some other logical order that facilitates finding specific values.

As a general rule, bars should always start at zero because people are conditioned to expect that.  Failing to do this can be confusing or misleading.  

\begin{problem}

The following table provides average heights of men and women in 17 countries. Order the data and plot a horizontal bar chart. 


\begin{tabular}{ | l || l | l | }
\hline
Country & Average Male Height & Average Female Height \\
\hline
Austria & 179.2 cm (5 ft 7.5 in) & 167.6 cm (5 ft 6 in) \\
Bolivia & 160.0 cm (5 ft 3 in) & 142.2 cm (4 ft 8 in) \\
England & 177.8 cm (5 ft 10 in) & 164.5 cm (5 ft 5 in) \\
Finland & 178.9 cm (5 ft 10.5 in) & 165.3 cm (5 ft 5 in) \\
Germany & 178 cm (5 ft 10 in) & 165 cm (5 ft 5 in) \\
Hungary & 176 cm (5 ft 9.5 in) & 164 cm (5 ft 4.5 in) \\
Japan & 172.5 cm (5 ft 7.5 in) & 158 cm (5 ft 2 in) \\
North Korea & 165.6 cm (5 ft 5 in) & 154.9 cm (5 ft 1 in) \\
South Korea & 170.8 cm (5 ft 7 in) & 157.4 cm (5 ft 2 in) \\
Montenegro & 183.2 cm (6 ft 0 in) & 168.4 cm (5 ft 6.5 in) \\
Norway & 182.4 cm (6 ft 0 in) & 168 cm (5 ft 6 in) \\
Peru & 164 cm (5ft 4.5 in) & 151 cm (4 ft 11.5 in) \\
Sri Lanka & 163.6 cm (5 ft 4.5 in) & 151.4 cm (4 ft 11.5 in) \\
Switzerland & 175.4 cm (5 ft 9 in) & 164 cm (5 ft 4.5 in) \\
Turkey & 174 cm (5 ft 8.5 in) & 158.9 cm (5 ft 2.5 in) \\
U.S. & 176.1 cm (5 ft 9.5 in) & 162.1 cm (5 ft 4 in) \\
Vietnam & 165.7 cm (5 ft 5 in) & 155.2 cm (5 ft 1 in) \\
\hline
\end{tabular}
\label{prob1}
\end{problem}





\subsection*{Histograms}


A histogram depicts a distribution of numerical data.  To construct a histogram of several one-dimensional data points, we divide the data into "bins" based on what range they lie in, and then we plot a bar whose height corresponds to the number of points in the bin.  Histograms can give a clear view of the way data is distributed, but sometimes changing the size and position of the bins can change the picture substantially.  You can create a histogram in matplotlib with the command \li{plt.hist()}. 

When plotting histograms, it can sometimes be useful to include reference lines.  A nice way to do this without cluttering the figure is to make the reference lines white.  You can do this in matplotlib with the command \li{plt.grid(True, color='w',linestyle='-')}.


%TODO example of a basic histogram.  Be sure to show the data so the reader can see how this is different from a standard bar.  Also give an example of the same data with bins a different size that gives a different picture.


\begin{lstlisting}
from numpy.random import randn
from matplotlib import pyplot as plt

data = randn(75) + randn(75) + randn(75) + randn(75)
plt.hist(data)
plt.grid(True, color = 'w', linestyle = '-')

plt.title("histogram")
plt.show()

\end{lstlisting}

\begin{figure}
\centering
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{histogram.png}
\end{subfigure}
\centering
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{histogram_referenceLines.png}
\end{subfigure}
\caption{Histogram and Histogram with Reference Lines}
\label{fig:histogram}
\end{figure}



\begin{problem}
Using 1000 random numbers from a normal distribution,
\begin{lstlisting}
from numpy.random import normal
normal_numbers = normal(size=1000)
\end{lstlisting}
plot a histogram with white reference lines.  Do this for 20 bins, 10 bins, 5 bins, and 3 bins.

\end{problem}

\subsection*{Line Plots}

Line plots should not be used for data that is one-dimensional or is two-dimensional with no natural ordering or progression because it gives the false impression that there is an order or progression when none exists (see Figure \ref{fig:lineplotbadX}).

Recall that you can create a line plot in matplotlib with the command \li{plt.plot()}.

When plotting line graphs in matplotlib, the default line width is usually too thin.  It will help your reader (or you) if you set the line width to 2 or more with the argument \li{lw=2} (See Figure \ref{fig:lineplot_bad}).

%\li{plt.plot(x,y,lw=2)}


\begin{figure}
\centering
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{line_plot_bad_thin.png}
\end{subfigure}
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{line_plot_good.png}
\end{subfigure}
\caption{Line Plot.  The left plot is plotted with \li{lw=1} whereas the right plot is plotted with \li{lw=2}.  Notice that the right plot is better because it is easier to see the line.}
\label{fig:lineplot_bad}
\end{figure}

\begin{figure}
\centering
\begin{subfigure}{.5\textwidth}
\centering
\includegraphics[width=\textwidth]{line_plot_bad_X.png}
\end{subfigure}
\caption{Line plot.  Notice that this graph appears to show that the x-values are ordered.  However, in reality, they are unordered.  This is a bad practice and misrepresents the data.}
\label{fig:lineplotbadX}
\end{figure}


\begin{problem}
Using 1000 data points, plot the equation

$$y = x^2\sin(x),$$
$$x \in [0,100].$$


It should look like Figure \ref{fig:lineplot}.
\end{problem}

\begin{figure}
\centering
\begin{subfigure}{.5\textwidth}
\centering
\includegraphics[width=\textwidth]{line_plot.png}
\end{subfigure}
\caption{Solution to Problem 3}
\label{fig:lineplot}
\end{figure}


\subsection*{Scatter Plots} 

Scatter plots graph $(x,y)$ tuples and should be used instead of line plots when the data is two-dimensional but has no natural order. 
 
You can create a scatter plot in matplotlib with the command \li{plt.scatter()}.

\begin{figure}[h]
\centering
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{scale_scatter_zoomed_in.png}
\end{subfigure}
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{scale_scatter_zoomed_out.png}
\end{subfigure}
\caption{Scatter Plots.  The data in both plots are the same, but note how in the first we see little correlation compared to the second.  This is solely an artifact of the scale of the plot.  Keep this in mind when you make scatter plots.}
\label{fig:scatter_correlation}
\end{figure}


Figure \ref{fig:scatter_correlation} displays two scatter plots, the first appearing to have no strong correlation and the second a strong correlation. However, the same data is being plotted and the only difference is the scale and window size. Manipulating these can change your interpretation and should be done with careful consideration.

\begin{problem}
Plot the average heights of men ($y$) against women ($x$) using the data from Problem \ref{prob1}. Zoom in and out to see what difference that makes.
\end{problem}




\subsection*{Contour Plots and Heat Maps}

Three-dimensional data can be displayed on a two-dimensional page with a \emph{contour plot}.  This draws lines in the plane where the third value is constant---like a topographical map.  

You can create a contour plot in matplotlib with 
\li{plt.contour()}.

Filling in the contours with successive colors gives a  \emph{heat map}. Note that the default color map for matplotlib is the  \emph{rainbow color map}.  This is a poor choice for a heat map or colored contour map because people do not naturally interpret one color to be greater than another.  To solve this problem in matplotlib, use the argument \li{cmap='NAME\_OF\_COLORMAP'}
where \li{NAME\_OF\_COLORMAP} is one of matplotlib's sequential or diverging colormaps like \li{afmhot}. 

\begin{figure}[h]
\centering
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{contour_map.png}
\end{subfigure}
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{contour_map_filled.png}
\end{subfigure}
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{contour_map_rainbow_filled.png}
\end{subfigure}
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{contour_map_rainbow.png}
\end{subfigure}
\caption{Contour Maps.  The top left is a good contour map and the top right is a good heat map, and the bottom two are inferior because of bad color choices.  The top right corresponds to the code below.}
\label{fig:contour}
\end{figure}

\begin{lstlisting}
# This code corresponds to the figure on the top right of the contour maps.
import numpy as np
from matplotlib import pyplot as plt

n=400
xran = np.linspace(-1.5,1.5,n)
yran = np.linspace(-1.5,1.5,n)
X, Y = np.meshgrid(xran,yran)
F = Y**2 - X**3 + X**2
plt.contourf(X, Y, F, [-2,-1,0.0001,1,2,3,4,5] ,cmap=plt.get_cmap('afmhot'))
\end{lstlisting}

Two sequential colormaps are \li{afmhot} and \li{cool}.  Two diverging colormaps are \li{seismic} and \li{bwr}.  These colormaps along with their color scheme can be found on \url{http://matplotlib.org/examples/color/colormaps_reference.html}.




\begin{problem}
Using 400 intervals, plot a filled contour map of

$$z = \sin(x) + \sin(y),$$ $$ x\in[0,12\pi], y\in[0,12\pi].$$ 

Be sure to use an appropriate color map. 
\end{problem}


\begin{figure}
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{heatmap_color.png}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{heatmap_hot.png}
\end{subfigure}
%\includegraphics[width=\textwidth]{heatmap.png}
\caption{Both of these pseudocolor plots depict the function $z = \sin(x)\sin(y)$ on the domain $[-1,4] \times [-4,1]$. 
The plot on the left uses a rainbow gradient, which is pretty to look at, but whose choice of colors has no meaningful relationship to the data. 
The plot on the right uses the color map called \li{afmhot}, which has the important benefit that the lighter colors are naturally associated with higher values, while the darker colors are naturally associated with lower values.}
\label{fig:heatmap}
\end{figure}



You can also create a pseudocolor plot in matplotlib with the \li{plt.pcolormesh()} command.


\begin{comment}
TODO example of a cloropleth---maybe percentage income donated to charity by county? (makes Utah look good).

As in the case of a histogram, if the data is relatively coarse then the way the data is divided up can have an effect on the overall picture of the heat map.

TODO make an example where things are binned in two different ways  and give a different-looking result.

\end{comment}


Finally, three-dimensional data can also be plotted as a surface in 3-space, but it is often difficult to find a view where none of the important features of the data are obscured.
A heatmap can help avoid this problem and is often easier for the viewer to decode (see Problem \ref{prob:differentVisualizations}).

\section*{Exploring Data with Visualizations}
When you visualize data you may notice trends that are not apparent from the numbers. 
The following problem is a famous example of this phenomenon.

\begin{problem}\label{prob:anscombe}
The data sets I-IV in Table \ref{table:anscombe} are known as Anscombe's quartet. 
Each data set has identical statistical properties. 
In each case,
\begin{itemize}
\item The mean of $x$ is 9 and the mean of $y$ is $7.5$.
\item The variance of $x$ is 11 and the variance of $y$ is 4.127.
\item The correlation between $x$ and $y$ is .816.
\item The linear regression line is $y=3+5x$.
\end{itemize}
Plot each data set. What do you notice?

\begin{table}[H]
\begin{tabular}{l l  |  l l  |  l l  |  l l }
I & & II & & III & & IV\\
x & y & x & y & x & y & x & y \\
\hline
10.0 & 8.04 & 10.0 & 9.14 & 10.0 & 7.46 & 8.0 & 6.58 \\
8.0 & 6.95 & 8.0 & 8.14 & 8.0 & 6.77 & 8.0 & 5.76 \\
13.0 & 7.58 & 13.0 & 8.74 & 13.0 & 12.74 & 8.0 & 7.71 \\
9.0 & 8.81 & 9.0 & 8.77 & 9.0 & 7.11 & 8.0 & 8.84 \\
11.0 & 8.33 & 11.0 & 9.26 & 11.0 & 7.81 & 8.0 & 8.47 \\
14.0 & 9.96 & 14.0 & 8.10 & 14.0 & 8.84 & 8.0 & 7.04 \\
6.0 & 7.24 & 6.0 & 6.13 & 6.0 & 6.08 & 8.0 & 5.25 \\
4.0 & 4.26 & 4.0 & 3.10 & 4.0 & 5.39 & 19.0 & 12.50 \\
12.0 & 10.84 & 12.0 & 9.13 & 12.0 & 8.15 & 8.0 & 5.56 \\
7.0 & 4.82 & 7.0 & 7.26 & 7.0 & 6.42 & 8.0 & 7.91 \\
5.0 & 5.68 & 5.0 & 4.74 & 5.0 & 5.73 & 8.0 & 6.89 \\
\end{tabular}
\caption{These four sets of data are known as Anscombe's quartet.}
\label{table:anscombe}
\end{table}
\end{problem}

As Problem \ref{prob:anscombe} demonstrates, a picture can quickly reveal properties of the data that are difficult to see in a list of numbers.

\subsection*{The Iterative Process of Exploratory Visualization} 

Understanding a data set through visualization is often an iterative process. We start with an initial visualization---usually a broad overview.  Examining the result leads to observations that provoke questions.  We then filter or transform the data and adjust the visualization based on those questions and observations, and then repeat the process until we converge on a useful result.

Some of the questions that you should be asking in this iterative process include:
\begin{enumerate}
\item Is the data correct and reliable? 
\item Are there any clear patterns, trends, or irregularities?
\item Would a different type of visualization give more information?
\item Is something unusual or interesting going on outside my view?
\item Would filtering the data to look at a particular subset give a more informative picture?
\item Would a transformation of the data give a more informative picture?
\end{enumerate}
Let's consider each of these questions in more detail.

\subsubsection*{1. Data Integrity}

Visualization is a powerful way to identify problems with your data set.  Ask yourself, whether the results look like what you expect.  Are they the right magnitude? Are there missing values? 

\subsubsection*{2. Trends, Patterns, and Irregularities}

Some patterns you may look for:
\begin{enumerate}
\item Are there trends in time (up, down, flat, cyclical)?
\item Does the data look random, cyclical, or patterned?
\item Are there clear correlations between the $x$- and $y$-values? 
\item Is the trend linear or curved?
\item Do lines intersect, or are they parallel?
\item Is the data symmetric or skewed?
\item What is the variance (wide vs narrow)?
\item Are there clusters and gaps?
\item Is the data dense or sparse?
\end{enumerate}

\subsubsection*{3. Using Different Types of Visualization}

Data can be visualized using different types of visualization and is relatively easy to transform.

\begin{problem}
This is an example of a surface that obscures your view:
\begin{lstlisting}
x = np.linspace(-2*np.pi,2*np.pi,num=400)
y = np.linspace(-2*np.pi,2*np.pi,num=400)
X, Y = np.meshgrid(x,y)
Z = np.exp(np.cos(np.sqrt(X**2 + Y**2)))
fig = plt.figure()
ax = fig.gca(projection='3d')
ax.plot_surface(X,Y,Z)
plt.show()
\end{lstlisting}
Change this surface to a heatmap or a contour plot.  Return a string of the benefits of each type of visualization.  See the beginning of the lab for how to make a contour plot.
\label{prob:differentVisualizations}
\end{problem}

\begin{comment}
\begin{problem}
This data

\begin{tabular}{ | l || l | l | }
\hline
Number of students playing each instrument  & \\
\hline
Cello & 14 \\
Clarinet & 41 \\
Flute & 30 \\
Guitar & 15 \\
Piano & 53 \\
Saxophone & 18 \\
Violin & 22 \\
\hline
\end{tabular}

 is visualized in Figure \ref{fig:pie} as a pie chart.

Choose another type of visualization and plot the data again. What are the relative merits of your plot compared to the pie chart?

\end{problem}
\end{comment}

\begin{comment}
\begin{figure}
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{pie_instruments.png}
\end{subfigure}%
\caption{Pie Chart for instrument problem}
\label{fig:pie}
\end{figure}
\end{comment}

\subsubsection*{4. Changing the View}

By choosing to plot only a portion of your data, you may be able to focus your attention on the most relevant data.  On the other hand, you may also miss some interesting behavior in the data you didn't graph. Figures \ref{fig:scatter_correlation} and \ref{fig:line_scale} are two such examples. 

Another issue to consider is scale. If a number changes from 50,000 to 55,000 over some period, that  increase can appear small or large, depending on where we start the $y$-axis and how long we stretch out the $x$-axis (see Figure \ref{fig:dog_plots}).

You can modify the scale of an existing plot using \li{plt.yscale()} or \li{plt.xscale()}.

\begin{figure}
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{scale_line_zoomed_in.png}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{scale_line_zoomed_out.png}
\end{subfigure}
\caption{Scale issues.  Notice that $y$-values on the left graph look random.  However, it is clear to see on the right graph that the $y$-values aren't as sporadic.}
\label{fig:line_scale}
\end{figure}



\begin{problem}
Return to your plot of 

$$y = x^2\sin(x)$$ $$x\in[0,100]$$

from Problem 3 and plot it a few more times adjusting the scale by setting the $y$ limits to be $\pm10^{k}$ for $k = 0,1,2,3,4$ by using the command 

\li{plt.ylim(lower_limit,upper_limit)}. 
\end{problem}



\subsubsection*{5. Filtering the Data}
Sometimes important information about a subset of the data can be obscured by considering the whole data set.  Some information is difficult to notice when all the data is combined into one plot.  But when the data is divided into subsets, more information can be gathered.  For example, when the height of males and females are plotted for multiple countries, there may appear to be a large variance.  But when males' heights and females' heights are isolated, more information about the variance can be deduced.


\begin{comment}
TODO example where scatterplot of all people looks random, but separating by something like education level shows clear trends for one level. 
\end{comment}

\subsubsection*{6. Transforming the Data}

Often a transformation of the data can reveal useful information that was previously hidden.

For example, data that grows very rapidly or that is tightly clustered may be better visualized by plotting the logarithm of the data, instead of the original data, A log-lin plot (also called a log plot) is constructed by by taking the logarithm of the $y$-values of your data set. 

This is easily done in matplotlib with the command \li{plt.semilogy(x,y)}.  The syntax is the same as \li{plt.plot()}.

On the left side of Figure \ref{fig:exp}, $x^{14}+1$ and $x^{13}+1$ look almost idential. Graphic them on a log-lin plot (as on the right side of Figure \ref{fig:exp}) makes their differences apparent.  Beware, however, that you should not label the transformed axis with transformed labels, because the reader ultimately needs the untransformed values.  So a log-lin plot could have $y$-axis with $10^{1},10^{2},10^{3},10^{4}$ etc.  all equidistant.  And not with values $1,2,3,4$ equidistant.

\begin{figure}[h]
\centering
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{exponential.png}
\end{subfigure}
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{exponential_loglin}
\end{subfigure}
\caption{Plotting exponential graphs on a log-lin plot}
\label{fig:exp}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=\textwidth]{log_plots.pdf}
\caption{Here are some functions plotted on various logarithmic and linear scales. 
The dark blue line is $y=x$, the green line is $y=\log(x)$, the red line is $y=e^x$, and the light blue line is $y=x^3$. 
We have used different ranges on the $y$-axes to highlight appropriate parts of the graphs.}
\label{fig:log_plots}
\end{figure}


Similarly, if the data grows very slowly, you may find that a lin-log plot (given by by taking the logarithm of the $x$-values) gives a more useful view.
This is easily done in matplotlib with the command \li{plt.semilogx(x,y)}.

Transformations can also be useful for histograms.
As an example, let us look at the cost of health care claims. 
Our data set is fabricated, but designed to closely resemble real-life data. 
An initial plotting of the data produces the histogram on the left in Figure \ref{fig:healthcare}. 
From this picture, it is hard to see the nature of the data---the plot almost looks like a single bar. 
We may think that all health care claims are cheap. 
However, when we take the logarithm of the claims prices, we get the histogram on the right in Figure \ref{fig:healthcare}. 
Graphed on this scale, the data has a bell-shaped distribution similar to a normal distribution. 
Moreover, we see that there are some very expensive claims being submitted, though they are few. 
\begin{figure}
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{healthcare_linscale.pdf}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=\textwidth]{healthcare_logscale.pdf}
\end{subfigure}
\caption{Two histograms of the same data are plotted above. 
The plot at left is a lin-lin scale, whereas the plot at right is a log-lin scale (log of the $y$-values). 
In this case, changing scales revealed important information about the data.}
\label{fig:healthcare}
\end{figure}

As a general rule, taking the log of the $y$-values is most useful when the range of the $y$-values is orders of magnitude larger than the range of the $x$-values. 
Our health care data was an example of this. 
Similarly, taking the log of the $x$-values is most useful when the range of the $x$-values is much bigger than the range of the $y$-values. 
In any case, you can try applying a log scale to one or both of your axes as a way to explore your data.

\begin{comment}
Let us analyze the mathematics behind log plots. 
Suppose we have some data that roughly follows the line $y=cx^a$ where $c$ and $a$ are constants. 
Taking the logarithm of both sides yields
\[
\log(y) = a\log(x) + \log(c).
\]
If we set new variables $X = \log(x)$ and $Y = \log(y)$, then this equation becomes $Y = aX + \log(c)$, which is the equation of a straight line. 
So on a log-log plot, polynomial-shaped data looks linear. 
Similarly, taking the log of $y = a^x$ yields
\[
\log(y) = \log(a)x,
\]
so exponential data looks linear on a log-lin plot. 
Finally, data of the form $y = a\log(x)+b$ will look linear on a lin-log plot. 
See Figure \ref{fig:log_plots}.
\end{comment}

Be warned that many different functions can look almost linear on log plots. 
Thus, if you graph your data on a log-log plot and you see a line, you cannot conclude that your data must follow a polynomial. 
In general, you need more information.

\begin{comment}
\begin{problem}
Graph your data from Problem 1 in the Complexity and Sparse Matrices lab on a (a) log-log scale, (b) log-lin scale, and (c) lin-log scale. 
Which plot makes the data easiest to understand?


In this problem you will analyze the complexity of the following functions.

\begin{enumerate}
\renewcommand{\theenumi}{\alph{enumi}}
\item (Optional)
\begin{lstlisting}
# Single ``for'' loop
def func1(n):
    n = 500*n
    sum(range(n))
\end{lstlisting}

\item 
\begin{lstlisting}
# Double ``for'' loop
def func2(n):
    n = 3*n
    t = 0
    for i in range(n):
        for j in range(i):
            t += j
\end{lstlisting}

\item
\begin{lstlisting}
# Square a matrix
def func3(n):
    n = int(1.2*n)
    A = np.random.rand(n, n)
    np.power(A, 2)
\end{lstlisting}

\item
\begin{lstlisting}
# Invert a matrix
from scipy import linalg as la
def func4(n):
    A = np.random.rand(n, n)
    la.inv(A)
\end{lstlisting}

\item (Optional)
\begin{lstlisting}
# Find the determinant of a matrix.
from scipy import linalg as la
def func5(n):
    n = int(1.25*n)
    A = np.random.rand(n, n)
    la.det(A)
\end{lstlisting}
\end{enumerate}


Do this as follows:
\begin{enumerate}
\item Time how long each function takes to run on an input of size $n$ for $n=100, 200, 400$, and $800$.
\item Graph your data as follows. Note that we rescaled the inputs to the functions so that your lines would begin at roughly the same place on the y-axis.
\begin{enumerate}
\item For each function, plot a line using $n=100, 200, 400$, and $800$ for $x$-values and your runtimes for $y$-values. Make sure your $y$-values are all in the same units! When you call the function \li{plt.plot()}, specify a value for the keyword parameter \li{label} so you can reference each line later. For example, the call \li{plt.plot( x, y, label="Function 1")} attaches the label "Function 1" to this line.
\item After plotting all your lines, call \li{plt.legend()} to draw a legend on your graph. Use the keyword argument \li{loc} to specify the location of the legend. Some possible values are \li{'upper left'} and \li{'right'}. See the documentation for more options. Your final graph should look something like the figure below.
%\footnote{From this graph, you can see that inverting a matrix is an incredibly time consuming operation. In Lab \ref{lab:ChangeBasis} you will learn fast algorithms for solving linear systems without inverting matrices. In fact, inverting matrices is so costly in terms of temporal and spatial complexity that there is hardly ever a good reason to do it.}
\end{enumerate}
\item For each function, discuss how its spatial and temporal complexity could have contributed to its runtime.
\end{enumerate}
\end{problem}
\end{comment}


\begin{comment}
\begin{problem}
Given the following data, 

\begin{tabular}{| l | l | l | l | l | l | l |}
\hline
Male & Female & Age & Marital status & College & Pet owner & Employed \\
\hline
Y & N & 21 & S &  N & N & N \\
N & Y & 25 & M & Y & Y & Y\\
Y & N & 26 & M & Y & Y & Y\\
Y & N & 20 & S & Y & N & Y\\
Y & N & 27 & M & Y & N & Y\\
N & Y & 22 & S & N & N & N\\
Y & N & 28 & M & Y & Y & Y\\
N & Y & 29 & M &  N & N & N\\
N & Y & 23 & S &  N & N & N\\
N & Y & 28 & M & N & N & Y\\
Y & N &  24 & S & Y & Y & Y\\
\hline
\end{tabular}

explore it. Plot it in different ways, zoom in and out, and do a transformation.
\end{problem}
\end{comment}


\section*{Communicating Data with Visualizations}

As the saying has it, ``a picture is worth a thousand words.'' 
Certainly, a data visualization is far more valuable than a thousand data points to a colleague who wants to understand the results of your analysis. 
Data visualizations are critical for communication in both business and research.

\subsection*{Choosing the Right Visualization}
At this point, you have already used visualization to explore your data and draw conclusions, and you are ready to tell your results to someone else. 
The first step in creating a graphic to do this is to choose the right type of visualization. 
As we saw in the section ``Types of Visualizations,'' there are many possibilities, each with different strengths. 
You should carefully consider which one best suits your data set and communication needs.  Your goal should always be communicating as clearly, effectively, and accurately as possible.  

\subsubsection*{Visualizations to Avoid: Pie Charts, Radar Charts, and Stacked Bar Charts}
There are also several popular types of visualizations that you should generally \textbf{not} use.  These may look pretty, but they tend to obscure information or cause confusion because of natural difficulties humans have in interpreting them.

For example, people have much more difficulty judging changes and variation in area than they do in length.  
As a result, charts that depend on distinguishing variation in area will be less effective and easily misunderstood.  One of the most common charts that has this problem is the pie chart. Figure \ref{fig:pievsbar} indicates the difficulty in judging the difference in area between the lobster and bean slices.

\begin{figure}
\centering
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{pie_chart_sorted.png}
\end{subfigure}
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{bar_chart_horizontal_sorted.png}
\end{subfigure}
\caption{A pie chart on the left that has been improved by a transformation into a bar chart on the right.}
\label{fig:pievsbar}
\end{figure}


As bad as the pie chart may be, there is a way to make things worse---make the chart three-dimensional.  It seems to be very popular for people to convert a visualization that is naturally 2 or 1 dimensional into one that is artificially three dimensional, but this inevitably makes things more confusing.  For example, we already have difficulty distinguishing the variation in area in a pie chart, and when we add a third dimension, it becomes even harder to distinguish variation in volume.


Other visualization types that tend to be confusing and ineffective include the stacked bar and the radar graph.  The radar graph is just generally confusing. The main problem with stacking bars is that the second bar is not based at zero, so it becomes difficult to compare the different parts, as in Figure \ref{fig:stacked}

\begin{figure}
\centering
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{stackedbar.png}
\end{subfigure}
\begin{subfigure}{.45\textwidth}
\centering
\includegraphics[width=\textwidth]{unstackedbar.png}
\end{subfigure}
\caption{Stacked Bar Chart. Note how much more difficult it is to compare the relative values when they are stacked (on the left) instead of adjacent (on the right).}
\label{fig:stacked}
\end{figure}

\subsection*{Simplify}

\noindent\emph{A sentence should contain no unnecessary words, a paragraph no unnecessary sentences for the same reason that a drawing should contain no unnecessary lines and a machine no unnecessary parts.} \small{---Strunk and White}


Once you have chosen the visualization best suited to your data, you should design the details so that all elements contribute to the communication of data. 

Data visualization guru, Edward Tufte, offers two principles for simplifying graphics: (1) erase ink that does not communicate data, and (2) erase ink that communicates data redundantly.  (\cite{tufte2001} pp.96-100). According to these principles, decorative backgrounds, fancy lettering, and cute graphics in the corner of your plots should all be deleted.

Other opportunities for simplification are harder to notice and implement. As an example, let us examine the plot on the right of Figure \ref{fig:healthcare}. 
This plot was created with the following code.

\begin{lstlisting}
import numpy as np
import scipy as sp
from matplotlib import pyplot as plt

m = 2.07
s = 0.63
num_samples = 10000
samples = []

for i in range(num_samples):
    samples.append(sp.random.normal(m, s)) 

sp_samples = sp.array(samples)

# Plot the histogram
plt.hist(sp_samples, 100)
\end{lstlisting}

For purposes of this example, the only important part of the above code is the line \li{plt.hist(sp_samples, 100)} that plots the histogram. 
What ink in this plot can we erase because it communicates no data?

First, let's get rid of the vertical black lines that separate the bars of the histograph and the black outline. These are meaningless for our application and only distract. 
We can do this by modifying our call to \li{plt.hist()} as follows.

\begin{lstlisting}
plt.hist(sp_samples, 100, edgecolor='none')
\end{lstlisting}

Next, let us turn off the top and right lines that box in the graph. 
To do this, we need to access the ``axis'' object associated with the figure. 
We can access the ``axis'' object with the command \li{plt.gca()} (get current axis).

\begin{lstlisting}
# Get current axis instance
axis = plt.gca()

# Hide top and right spines
axis.spines['right'].set_visible(False)
axis.spines['top'].set_visible(False)
\end{lstlisting}

These commands only turn off the sides of the box, not the tick marks. 
To turn off the tick marks we run the following commands. 

\begin{lstlisting}
# Only show bottom and left tick marks
axis.yaxis.set_ticks_position('left')
axis.xaxis.set_ticks_position('bottom')
\end{lstlisting}

Finally, we do not need so many tick marks on the $x$- and $y$-axes. 
We adjust those along with specifying the range on each axis.

\begin{lstlisting}
# Fix x- and y-ranges
plt.xlim(-1,5)
plt.ylim(0, 350)

# Use fewer axis ticks
plt.xticks(np.arange(0, 5, 2))
plt.yticks(np.arange(0, 351, 100))
\end{lstlisting}

The final graph is shown in Figure \ref{fig:simplify}. 
Note how much cleaner this looks than the original.

\begin{figure}
\centering
\includegraphics[width=\textwidth]{simplify.pdf}
\caption{A simplified version of the histogram in Figure \ref{fig:healthcare}.}
\label{fig:simplify}
\end{figure}


%TODO: Rewrite this problem to use a specific image with a specific context
\begin{problem}
Choose a graph you previously created that you think could use simplification. 
Apply at least 3 of the following to simplify your plot:
\begin{enumerate}
\item Turn off some of the spines.
\item Fix the x- or y-range to better fit your data.
\item Change the number of x- or y-ticks.
\item Choose a better color scheme.
\end{enumerate}
Simplify your image in any other ways you can think of.
\end{problem}

\subsection*{Small Multiples}

Often we have too much information to display cleanly in one chart.  One indicator of this is if the reader must often look back and forth between a legend and the chart to decode the images.  A very useful way to deal with this problem is the method of \emph{small multiples}, an idea made famous by Edward Tufte.

The idea is to separate the data into many small graphics, placed near each other in a way that allows us to easily compare them.

For example, one might wish to compare the first six Chebyshev polynomials.  It would be natural to plot them together on the same graph, as in Figure \ref{fig:PoT}.  But this graph is too cluttered and one must constantly refer back to the legend to identify which colored line is which.

\begin{figure}
\centering
\begin{subfigure}{.45\textwidth}
  \centering
  \includegraphics[width=\textwidth]{PoT.png}
\end{subfigure}
\begin{subfigure}{.45\textwidth}
\centering
  \includegraphics[width=\textwidth]{PoT_separate.png}
\end{subfigure}
\caption{Chebyshev polynomials together on the left and separately on the right. Notice that the legend is no longer needed for the right graph and it is easier to compare between Chebyshev polynomials because the graph isn't cluttered.}
\label{fig:PoT}
\end{figure}

The small multiple approach is to plot each polynomial on its own set of axes, adjacent to each other and aligned in such a way that you can easily compare the different plots as in Figure\ref{fig:PoT}


Note how even with 9 plots instead of 6, it is much easier to identify the different polynomials and to compare them.

The main tool you need to make small multiples is the command \li{ax = plt.subplot()}.  This allows you to set up multiple plots, and access them one at a time.

\begin{lstlisting}
import numpy as np
from matplotlib import pyplot as plt
from numpy.polynomial import Chebyshev as T

def Chebyshev_subplots():
    fig = plt.figure(dpi=100)
    fig.set_size_inches(10,10)
    fig.suptitle('Chebyshev Polynomials', fontsize=20)

    x = np.linspace(-1,1,500)

    for i in range(9):
        ax = plt.subplot(3,3,i+1)
        ax.plot(x, T.basis(i)(x), lw=2, label="$T_%d$"%i)
        plt.xlim(-1.1,1.1)
        plt.ylim(-1.1,1.1)
        ax.set_title('$T_%d$'%i)
        if i%3:
            # remove the inner y-ticks and labels.
            ax.set_yticklabels([])
            ax.yaxis.set_ticks_position('none')
        if i<6:
            # remove the inner x-ticks and labels.
            ax.xaxis.set_ticks_position('none')
            ax.set_xticklabels([]) 

    plt.show()
\end{lstlisting}


\begin{problem}

The $n+1$ Bernstein basis polynomials of degree $n$ are defined as 

$$b_{v,n} = {{n} \choose {v}} x^v (1-x)^{n-v}, v = 0, 1,..., n.$$


Plot the Bernstein basis polynomials for $v,n$ in [0,3] as small multiples and compare that to the cluttered version of plotting them on top of each other.

\end{problem}

\begin{comment}
\subsection*{Tell the truth}

Just as graphics can tell your reader about your data, they can also give your viewer false impressions. 
You should never use data visualizations to mislead your reader. 
There are many ways that pictures can be used to lie, and some of them can be unintentional.

\subsubsection*{2- and 3-D Effects}
For example, we see differences in flat shapes by area, not width or height. 
Suppose you are creating a pictogram to demonstrate the recent increase in housing prices, which have doubled in the last $n$ years. 
So, you draw two houses, one whose sides are 1cm and one whose sides are 2cm. 
The area of the second house is now $2^2=4$ times as big as the area of the first. And your reader will likely interpret the picture as a four-fold increase rather than just double. 
Hence, you should make two-dimensional pictures proportional in \emph{area} to the numbers they represent.

Even worse, volume is cubed rather than squared, so if a picture is intended to look like a three-dimensional object, doubling the side lengths will give the impression of an eight-fold increase.

%TODO add figures with 2- and 3-d houses doubling in side length.

Three-dimensional special effects also tend to be misleading.  As mentioned above, a 3-D pie chart, for example, can be used to distort the sizes of its slices. 
Similarly, a 3-D histogram can use perspective to distort the relative differences between bars.

\subsubsection*{Base, Scale, and Labels}  

As mentioned above, bar charts should be based at 0 and all charts should be scaled in the way that most clearly conveys the most important and relevant information.  When there is a possibility of confusion, axes and key data values should be labeled for clarity.


\begin{figure}
\centering
\includegraphics[width=\textwidth]{dog_plots.pdf}
\caption{The graph of some data can look very different depending on the scale. 
Here are two graphs of the ``same'' line over the same range (1 to 4). 
The only difference is the $y$-range. Notice easy it is to manipulate the y-scale to imply either a large or small increase in $y$. 
These figures are especially misleading when we leave the range markers off of the $y$-axes.}
\label{fig:dog_plots}
\end{figure}

As in any form of communication, integrity is important in data visualization. 
You will win more respect for yourself and those you represent if you avoid misleading diagrams.


\subsection*{Additional Resources}

There are many software packages that facilitate the visual exploration of data. 
One Python library is Glue (see \cite{glue}).

Some packages for making nicer looking plots include \li{Seaborn} and \li{prettyplotlib}.  TODO get refs

For more about visualization of data, we highly recommend the following books:

TODO get full refs for the follwoing

\begin{itemize}
\item \emph{How to lie with statistics}
\item \emph{Envisioning Information} by Edward Tufte
\item \emph{The visual display of quantitative information} by Edward Tufte (2nd edition)
\item \emph{Now you see it} by Stephen Few
\end{itemize}

\end{comment}

\printbibliography